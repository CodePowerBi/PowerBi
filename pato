Fecha_UltimoViernes_MesTrimestreAnterior = 
VAR FechaActual = MAX('tablones_des_vista_salida_daily_lcr_ddbb'[date])
VAR MesActual = MONTH(FechaActual)
VAR AnioActual = YEAR(FechaActual)
VAR TrimestreActual = INT((MesActual - 1) / 3) + 1

VAR AnioTrimestreAnterior = IF(TrimestreActual = 1, AnioActual - 1, AnioActual)
VAR TrimestreAnterior = IF(TrimestreActual = 1, 4, TrimestreActual - 1)

VAR UltimoMes = 
    SWITCH(
        TrimestreAnterior,
        1, 3,   // Q1: marzo
        2, 6,   // Q2: junio
        3, 9,   // Q3: septiembre
        4, 12   // Q4: diciembre
    )

VAR FechaInicioUltimoMes = DATE(AnioTrimestreAnterior, UltimoMes, 1)
VAR FechaFinUltimoMes = EOMONTH(FechaInicioUltimoMes, 0)

VAR FechaFila = 'tablones_des_vista_salida_daily_lcr_ddbb'[date]
VAR EsViernes = WEEKDAY(FechaFila, 2) = 5  // WEEKDAY con tipo 2: lunes=1, viernes=5

RETURN
IF(
    FechaFila >= FechaInicioUltimoMes &&
    FechaFila <= FechaFinUltimoMes &&
    EsViernes,
    DATE(YEAR(FechaFila), MONTH(FechaFila), DAY(FechaFila)), // Devuelve solo fecha sin hora
    BLANK()
)
