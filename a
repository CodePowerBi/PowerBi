TotalValor_UltMesUltTrim = 
VAR MaxFechaValida =
    CALCULATE(
        MAX ( 'tablones_des_salida_buffer'[fecha] ),
        FILTER(
            ALL ( 'tablones_des_salida_buffer' ),
            'tablones_des_salida_buffer'[valor] <> 0
        )
    )
VAR MesVal    = MONTH( MaxFechaValida )
VAR AnioVal   = YEAR(  MaxFechaValida )
VAR Trime     = INT(( MesVal - 1 ) / 3) + 1

// Último mes de ese mismo trimestre
VAR MesFinalTrim =
    SWITCH(
        Trime,
        1, 3,    // Q1 → marzo
        2, 6,    // Q2 → junio
        3, 9,    // Q3 → septiembre
        4, 12    // Q4 → diciembre
    )

VAR FechaInicio = DATE( AnioVal, MesFinalTrim, 1 )
VAR FechaFin    = EOMONTH( FechaInicio, 0 )

RETURN
IF(
    'tablones_des_salida_buffer'[fecha] >= FechaInicio &&
    'tablones_des_salida_buffer'[fecha] <= FechaFin,
    CALCULATE(
        SUM( 'tablones_des_salida_buffer'[valor] ),
        ALL( 'tablones_des_salida_buffer' ),
        'tablones_des_salida_buffer'[fecha] >= FechaInicio,
        'tablones_des_salida_buffer'[fecha] <= FechaFin
    ),
    BLANK()
)
