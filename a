ValorUltMesTrimestre =
VAR ThisDate     = 'Tabla'[Fecha]
VAR ThisYear     = YEAR( ThisDate )
VAR ThisQuarter  = QUARTER( ThisDate )
VAR TargetMonth  = SWITCH( ThisQuarter, 1, 3, 2, 6, 3, 9, 4, 12 )

VAR MaxDateTarget =
    CALCULATE(
        MAX( 'Tabla'[Fecha] ),
        FILTER(
            ALL( 'Tabla' ),
            YEAR( 'Tabla'[Fecha] ) = ThisYear
            && MONTH( 'Tabla'[Fecha] ) = TargetMonth
        )
    )

VAR ValorTarget =
    IF(
        NOT( ISBLANK( MaxDateTarget ) ),
        CALCULATE( SUM( 'Tabla'[Valor] ), 'Tabla'[Fecha] = MaxDateTarget ),
        BLANK()
    )

VAR PrevQuarter  = ThisQuarter - 1
VAR PrevYear     = IF( PrevQuarter = 0, ThisYear - 1, ThisYear )
VAR PrevTargetMonth = SWITCH( PrevQuarter, 1, 3, 2, 6, 3, 9, 4, 12 )

VAR MaxDatePrev =
    CALCULATE(
        MAX( 'Tabla'[Fecha] ),
        FILTER(
            ALL( 'Tabla' ),
            YEAR( 'Tabla'[Fecha] ) = PrevYear
            && MONTH( 'Tabla'[Fecha] ) = PrevTargetMonth
        )
    )

VAR ValorPrev =
    IF(
        NOT( ISBLANK( MaxDatePrev ) ),
        CALCULATE( SUM( 'Tabla'[Valor] ), 'Tabla'[Fecha] = MaxDatePrev ),
        BLANK()
    )

RETURN
COALESCE( ValorTarget, ValorPrev )
