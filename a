TOTAL COLUMNA Celeste prueba :=
VAR FechaMaxDates =
    CALCULATE ( MAX ( 'Dates'[Date] ), ALL ( 'Dates' ) )

-- Intento en la fecha máxima del calendario
VAR ValorEnFechaMax =
    CALCULATE ( [MiMedidaBase], TREATAS ( { FechaMaxDates }, 'Dates'[Date] ) )

-- Último fin de trimestre con datos en informe_regulatorio <= FechaMaxDates
VAR FechaObjetivoIR =
    CALCULATE (
        MAX ( 'informe_regulatorio'[fecha] ),
        FILTER (
            ALL ( 'informe_regulatorio'[fecha] ),
            'informe_regulatorio'[fecha] <= FechaMaxDates
                && MONTH ( 'informe_regulatorio'[fecha] ) IN { 3, 6, 9, 12 }
        )
    )

-- Evalúa la medida base en esa fecha objetivo
VAR ValorEnFechaObjetivo =
    CALCULATE (
        [MiMedidaBase],
        KEEPFILTERS ( 'informe_regulatorio'[fecha] = FechaObjetivoIR )
    )
RETURN
COALESCE ( ValorEnFechaMax, ValorEnFechaObjetivo )
