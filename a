Level2_con_TOTAL =
VAR Epig =
    SELECTEDVALUE ( 'Dicc_Epigrafes_Total'[epigrafe_front_total] )

-- Selección del filtro Assets/Liabilities, pero sin "TOTAL"
VAR SelAL_SinTotal =
    EXCEPT (
        VALUES ( 'Dicc_Epigrafes_Total'[ASSETS O LIABILITIES] ),
        { "TOTAL" }
    )

VAR HayAL =
    COUNTROWS ( SelAL_SinTotal ) > 0

VAR FiltroEpigrafesTotal =
    FILTER (
        ALL ( 'diccionario_epigrafes_filter_vw'[id_epigrafe] ),
        'diccionario_epigrafes_filter_vw'[id_epigrafe]
            IN { 3134, 35, 26, 10, 22, 7, 18, 6, 13 }
    )
RETURN
IF (
    Epig = "TOTAL",
    CALCULATE (
        [ - Level2 ],

        -- 1) Filtrar SOLO los epígrafes del TOTAL
        FiltroEpigrafesTotal,

        -- 2) Ignorar selección {Assets, TOTAL} y reaplicar solo {Assets} o {Liabilities}
        REMOVEFILTERS ( 'Dicc_Epigrafes_Total'[ASSETS O LIABILITIES] ),
        IF (
            HayAL,
            TREATAS ( SelAL_SinTotal, 'Dicc_Epigrafes_Total'[ASSETS O LIABILITIES] )
        )
    ),
    CALCULATE (
        [ - Level2 ],
        TREATAS (
            VALUES ( 'Dicc_Epigrafes_Total'[id_epigrafe] ),
            'diccionario_epigrafes_filter_vw'[id_epigrafe]
        ),

        REMOVEFILTERS ( 'Dicc_Epigrafes_Total'[ASSETS O LIABILITIES] ),
        IF (
            HayAL,
            TREATAS ( SelAL_SinTotal, 'Dicc_Epigrafes_Total'[ASSETS O LIABILITIES] )
        )
    )
)
