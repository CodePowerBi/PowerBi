MaxFechaVÃ¡lida_formateada = 
VAR MaxFechaValida =
    CALCULATE (
        MAX ( 'vista_salida_nsfr'[fecha] ),
        FILTER (
            ALL ( 'vista_salida_nsfr' ),
            'vista_salida_nsfr'[nsfr] <> 0
                && 'vista_salida_nsfr'[id_unit] = PaisActual
        )
    )

VAR MesVal = MONTH ( MaxFechaValida )
VAR AnioVal = YEAR ( MaxFechaValida )
VAR Trime = INT ( ( MesVal - 1 ) / 3 ) + 1

VAR MesFinalTrim =
    SWITCH (
        Trime,
        1, 3,
        2, 6,
        3, 9,
        4, 12,
        BLANK ()
    )

VAR FechaTrim =
    IF (
        NOT ISBLANK ( MaxFechaValida ),
        DATE ( AnioVal, MesFinalTrim, 1 ),
        BLANK ()
    )

VAR TextoFormateado =
    IF (
        NOT ISBLANK ( FechaTrim ),
        FORMAT ( FechaTrim, "MMM yy", "en-US" ),
        BLANK ()
    )

RETURN
    TextoFormateado
