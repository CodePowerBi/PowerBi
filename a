Amount_3M_Atras_Vlookup :=
VAR FechaFila =
    SELECTEDVALUE ( 'pag7_nueva'[Effective_date] )
VAR CPFila =
    SELECTEDVALUE ( 'pag7_nueva'[CounterpartyName] )
VAR Fecha3M =
    EDATE ( FechaFila, -3 )
RETURN
IF (
    NOT ISBLANK ( FechaFila ) &&
    NOT ISBLANK ( CPFila ),
    CALCULATE (
        SUM ( Pag7_Top10_mensual[amount_received] ),
        FILTER (
            ALL ( Pag7_Top10_mensual ),
            Pag7_Top10_mensual[counterparty_name] = CPFila
                && YEAR ( Pag7_Top10_mensual[fechha] ) = YEAR ( Fecha3M )
                && MONTH ( Pag7_Top10_mensual[fechha] ) = MONTH ( Fecha3M )
        )
    )
)
