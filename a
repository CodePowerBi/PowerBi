Top10_mensual =
VAR BaseConMes =
    ADDCOLUMNS (
        'mrf_plantilla_67',
        "fecha_mes", DATE ( YEAR ( 'mrf_plantilla_67'[fecha] ), MONTH ( 'mrf_plantilla_67'[fecha] ), 1 )
    )
VAR AgregadoMesCounterparty =
    -- Aquí sí usamos CURRENTGROUP, porque va dentro de GROUPBY
    GROUPBY (
        BaseConMes,
        [fecha_mes],
        'mrf_plantilla_67'[counterparty_name],
        "amount_received", SUMX ( CURRENTGROUP (), 'mrf_plantilla_67'[amount_received] )
    )
VAR ConRanking =
    ADDCOLUMNS (
        AgregadoMesCounterparty,
        "position",
            VAR mes = [fecha_mes]
            RETURN
            RANKX (
                FILTER ( AgregadoMesCounterparty, [fecha_mes] = mes ),
                [amount_received],
                ,
                DESC,
                DENSE
            )
    )
RETURN
SELECTCOLUMNS (
    FILTER ( ConRanking, [position] <= 10 ),
    "position", [position],
    "counterparty_name", 'mrf_plantilla_67'[counterparty_name],
    "fecha", [fecha_mes],
    "amount_received", [amount_received]
)
