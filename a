_MaxFecha_Válida_Buffer = 
VAR MaxFechaValida =
    CALCULATE(
        MAX( 'tablones_des_salida_buffer'[fecha] ),
        FILTER(
            ALL( 'tablones_des_salida_buffer' ),
            'tablones_des_salida_buffer'[tipo_buffer] 
                IN { "level_a", "level_b", "level_c" }
        )
    )
VAR MesActual        = MONTH( MaxFechaValida )
VAR AnioActual       = YEAR ( MaxFechaValida )
VAR TrimestreActual  = INT(( MesActual - 1 ) / 3) + 1

// Determina el trimestre COMPLETO anterior
VAR TrimestrePrev = IF( TrimestreActual = 1, 4, TrimestreActual - 1 )
VAR AnioPrev      = IF( TrimestreActual = 1, AnioActual - 1, AnioActual )

// El último mes de ese trimestre anterior
VAR MesUltimoPrevTrim =
    SWITCH(
        TrimestrePrev,
        1, 3,   // Q1 → marzo
        2, 6,   // Q2 → junio
        3, 9,   // Q3 → septiembre
        4, 12   // Q4 → diciembre
    )

// Primer día de ese mes
RETURN
DATE( AnioPrev, MesUltimoPrevTrim, 1 )
