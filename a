SELECT
    c.id_unit AS pais,
    DATE_TRUNC('month', a.fecha)::date AS mes,
    b.tipo_buffer,
    ROUND(SUM(a.valor)::numeric, 2) AS sum_valor_metrica
FROM salida_buffer_vw a
INNER JOIN dicc_tipo_buffer_buffer b
    ON a.tipo_buffer = b.id
INNER JOIN dicc_id_unit_buffer c
    ON a.id_unit = c.id_unit
WHERE a.fecha >= '2025-03-01'
  AND a.fecha <  '2025-10-17'
GROUP BY
    c.id_unit,
    DATE_TRUNC('month', a.fecha)::date,
    b.tipo_buffer
ORDER BY
    c.id_unit,
    mes,
    b.tipo_buffer;
