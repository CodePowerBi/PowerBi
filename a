SELECT
    a.id_unit,
    DATE_TRUNC('month', a.fecha)::date AS mes,
    b.metrica,
    ROUND(SUM(a.valor_metrica)::numeric, 2) AS sum_valor_metrica
FROM tablones_des_salida_buffer_hqla_vw a
INNER JOIN dicc_metrica_buffer_hqla b 
    ON a.metrica = b.id
WHERE a.fecha >= '2025-03-01'
  AND a.fecha < '2025-04-01'
GROUP BY
    a.id_unit,
    DATE_TRUNC('month', a.fecha)::date,
    b.metrica
ORDER BY
    a.id_unit,
    mes,
    b.metrica;
