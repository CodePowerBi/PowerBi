_MaxMesUltTrimVal_Buffer = 
VAR MaxFechaValida =
    CALCULATE(
        MAX( 'tablones_des_salida_buffer'[fecha] ),
        FILTER(
            ALL( 'tablones_des_salida_buffer' ),
            'tablones_des_salida_buffer'[tipo_buffer] 
                IN { "level_a", "level_b", "level_c" }
        )
    )
VAR Anio   = YEAR( MaxFechaValida )
VAR Mes    = MONTH( MaxFechaValida )
VAR Trime  = INT(( Mes - 1 ) / 3) + 1

VAR MesFinalTrime = 
    SWITCH(
        Trime,
        1, 3,   // Q1 → marzo
        2, 6,   // Q2 → junio
        3, 9,   // Q3 → septiembre
        4, 12   // Q4 → diciembre
    )

RETURN
DATE( Anio, MesFinalTrime, 1 )
