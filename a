Top10_por_mes_mrf_67 :=
VAR Base :=
    SELECTCOLUMNS (
        'tablones_des mrf_plantilla_67',
        "counterparty_name", 'tablones_des mrf_plantilla_67'[<<NOMBRE_REAL_COUNTERPARTY>>],
        "effective_date",   'tablones_des mrf_plantilla_67'[<<NOMBRE_REAL_FECHA>>],
        "amount_received",  'tablones_des mrf_plantilla_67'[<<NOMBRE_REAL_AMOUNT>>]
    )
VAR ConMes :=
    ADDCOLUMNS (
        Base,
        "fecha",
            DATE (
                YEAR ( [effective_date] ),
                MONTH ( [effective_date] ),
                1
            )
    )
VAR Agregado :=
    GROUPBY (
        ConMes,
        ConMes[counterparty_name],
        ConMes[fecha],
        "amount_received",
            SUMX ( CURRENTGROUP (), ConMes[amount_received] )
    )
VAR ConRanking :=
    ADDCOLUMNS (
        Agregado,
        "rk",
            VAR m = [fecha]
            RETURN RANKX ( FILTER ( Agregado, [fecha] = m ), [amount_received], , DESC, DENSE )
    )
RETURN
SELECTCOLUMNS (
    FILTER ( ConRanking, [rk] <= 10 ),
    "counterparty_name", [counterparty_name],
    "fecha", [fecha],
    "amount_received",_
