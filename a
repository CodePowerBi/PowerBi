_MaxFecha_Válida_Trading = 
VAR FechaMaxDatos = 
    CALCULATE(
        MAX ( 'tablones_des_tabla_trading'[fecha] ),
        FILTER(
            ALL ( 'tablones_des_tabla_trading' ),
            'tablones_des_tabla_trading'[Valor] <> 0
        )
    )
VAR MesMax     = MONTH( FechaMaxDatos )
VAR AnioMax    = YEAR ( FechaMaxDatos )
VAR Trimestre  = INT( ( MesMax - 1 ) / 3 ) + 1

// Determina el trimestre COMPLETO anterior
VAR TrimestrePrev = IF( Trimestre = 1, 4, Trimestre - 1 )
VAR AnioPrev      = IF( Trimestre = 1, AnioMax - 1, AnioMax )

// Último mes de ese trimestre anterior
VAR MesUltimoPrevTrim = 
    SWITCH(
        TrimestrePrev,
        1, 3,   // Q1 → marzo
        2, 6,   // Q2 → junio
        3, 9,   // Q3 → septiembre
        4, 12   // Q4 → diciembre
    )

// Fecha: primer día de ese mes
VAR FechaPrimerDia = DATE( AnioPrev, MesUltimoPrevTrim, 1 )

RETURN
FechaPrimerDia
