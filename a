Level2_con_TOTAL :=
VAR _idFila = SELECTEDVALUE ( 'Dicc_Epigrafes_Total'[id_epigrafe] )
VAR _esTotal = _idFila = 999

-- ids permitidos por el slicer Assets/Liabilities
VAR _idsPorSlicer =
    CALCULATETABLE (
        VALUES ( 'diccionario_epigrafes_filter_vw'[id_epigrafe] ),
        REMOVEFILTERS ( 'Dicc_Epigrafes_Total'[id_epigrafe] )
    )

-- ids finales: los de la dimensión que además estén permitidos por slicer (y sin 999)
VAR _idsFinales =
    FILTER (
        INTERSECT (
            VALUES ( 'Dicc_Epigrafes_Total'[id_epigrafe] ),
            _idsPorSlicer
        ),
        'Dicc_Epigrafes_Total'[id_epigrafe] <> 999
    )

RETURN
SWITCH (
    TRUE (),

    ISBLANK ( _idFila ), BLANK (),

    NOT _esTotal,
        -- filas normales
        [Level2],

    -- fila TOTAL: suma de epígrafes finales
    SUMX (
        _idsFinales,
        CALCULATE (
            [Level2],
            REMOVEFILTERS ( 'Dicc_Epigrafes_Total'[id_epigrafe] ),
            TREATAS ( { 'Dicc_Epigrafes_Total'[id_epigrafe] }, 'Dicc_Epigrafes_Total'[id_epigrafe] )
        )
    )
)
