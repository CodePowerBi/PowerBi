-- Factor común (opcional)
_Base Celeste :=
DIVIDE ( [Conjunto_1] + [Conjunto_2] + [Conjunto_3] + [Conjunto_4] + [Conjunto_5], 1000 )

TOTAL COLUMNA Celeste prueba :=
VAR FechaMaxDates =
    CALCULATE ( MAX ( 'Dates'[Date] ), ALL ( 'Dates' ) )

-- Último fin de trimestre con datos en la tabla de hechos, no posterior a FechaMaxDates
VAR FechaObjetivo :=
    CALCULATE (
        MAX ( 'informe_regulatorio'[fecha] ),
        FILTER (
            ALL ( 'informe_regulatorio'[fecha] ),
            'informe_regulatorio'[fecha] <= FechaMaxDates
                && MONTH ( 'informe_regulatorio'[fecha] ) IN { 3, 6, 9, 12 }
        )
    )
RETURN
-- Evalúa la medida en esa fecha objetivo (p.ej., septiembre)
CALCULATE ( [_Base Celeste], TREATAS ( { FechaObjetivo }, 'Dates'[Date] ) )
