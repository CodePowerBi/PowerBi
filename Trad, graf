Month_ALERT_GrupoConstante :=
VAR FechaMax =
    CALCULATE(
        MAX('tablon_des_tabla_trading'[fecha]),
        FILTER('tablon_des_tabla_trading', 'Country_Trading'[Country_Limpio] = "Group")
    )
VAR MesActual = MONTH(FechaMax)
VAR AnioActual = YEAR(FechaMax)
VAR TrimestreActual = INT((MesActual - 1) / 3) + 1
VAR AnioTrimestreAnterior = IF(TrimestreActual = 1, AnioActual - 1, AnioActual)
VAR TrimestreAnterior = IF(TrimestreActual = 1, 4, TrimestreActual - 1)
VAR UltimoMes =
    SWITCH(
        TrimestreAnterior,
        1, 3,
        2, 6,
        3, 9,
        4, 12
    )
VAR FechaReferencia = DATE(AnioTrimestreAnterior, UltimoMes, 1)

VAR ValorGrupo =
    CALCULATE(
        MAXX(
            FILTER(
                'tablon_des_tabla_trading',
                'tablon_des_tabla_trading'[fecha] = FechaReferencia &&
                'tablon_des_tabla_trading'[tipo] = "Alert"
            ),
            'tablon_des_tabla_trading'[valor]
        ),
        FILTER(ALL('tablon_des_tabla_trading'), 'Country_Trading'[Country_Limpio] = "Group")
    )

RETURN
    IF(ISBLANK(ValorGrupo), 0.0, ValorGrupo)
